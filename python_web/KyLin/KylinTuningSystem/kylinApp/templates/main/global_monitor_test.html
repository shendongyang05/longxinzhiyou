{% extends 'layout.html' %}

{% block title %}å…¨å±€ç›‘æ§æµ‹è¯•{% endblock %}

{% block css %}
<style>
    .test-container {
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .status-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    
    .status-item {
        margin: 10px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 3px;
    }
    
    .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
    }
    
    .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
</style>
{% endblock %}

{% block content %}
<div class="test-container">
    <h1>ğŸŒ å…¨å±€ç›‘æ§æµ‹è¯•é¡µé¢</h1>
    
    <div class="status-section">
        <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
        <div class="status-item">
            <strong>é€‰ä¸­çš„IP:</strong> <span id="currentIp">æœªè®¾ç½®</span>
        </div>
        <div class="status-item">
            <strong>é€‰ä¸­çš„ç«¯å£:</strong> <span id="currentPort">æœªè®¾ç½®</span>
        </div>
        <div class="status-item">
            <strong>CPUé˜ˆå€¼:</strong> <span id="cpuThreshold">æœªè®¾ç½®</span>
        </div>
        <div class="status-item">
            <strong>å†…å­˜é˜ˆå€¼:</strong> <span id="memThreshold">æœªè®¾ç½®</span>
        </div>
        <div class="status-item">
            <strong>ç£ç›˜é˜ˆå€¼:</strong> <span id="diskThreshold">æœªè®¾ç½®</span>
        </div>
        <div class="status-item">
            <strong>ç½‘ç»œé˜ˆå€¼:</strong> <span id="netThreshold">æœªè®¾ç½®</span>
        </div>
        <div class="status-item">
            <strong>ç›‘æ§çƒçŠ¶æ€:</strong> <span id="ballStatus">æ­£å¸¸</span>
        </div>
        <div class="status-item">
            <strong>å‘Šè­¦æ•°é‡:</strong> <span id="alertCount">0</span>
        </div>
    </div>
    
    <div class="status-section">
        <h3>ğŸ”§ æ“ä½œ</h3>
        <button class="button" onclick="updateStatus()">åˆ·æ–°çŠ¶æ€</button>
        <button class="button" onclick="testMonitor()">æµ‹è¯•ç›‘æ§</button>
        <button class="button" onclick="simulateData()">æ¨¡æ‹Ÿæ•°æ®</button>
        <button class="button" onclick="clearAlerts()">æ¸…é™¤å‘Šè­¦</button>
        <button class="button" onclick="clearStorage()">æ¸…é™¤è®¾ç½®</button>
        <button class="button" onclick="goToDataCollection()">è·³è½¬åˆ°æ•°æ®é‡‡é›†</button>
    </div>
    
    <div class="status-section">
        <h3>ğŸ“ è¯´æ˜</h3>
        <p>1. åœ¨æ•°æ®é‡‡é›†é¡µé¢è®¾ç½®é˜ˆå€¼å’Œé€‰æ‹©æœåŠ¡å™¨</p>
        <p>2. è·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼Œç›‘æ§çƒä¼šç»§ç»­å·¥ä½œ</p>
        <p>3. å½“æ•°æ®è¶…è¿‡é˜ˆå€¼æ—¶ä¼šæ˜¾ç¤ºå‘Šè­¦</p>
        <p>4. å‘Šè­¦ä¼šåœ¨æ‰€æœ‰é¡µé¢æ˜¾ç¤º</p>
    </div>
</div>

<script>
function updateStatus() {
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    document.getElementById('currentIp').textContent = localStorage.getItem('selectedIp') || 'æœªè®¾ç½®';
    document.getElementById('currentPort').textContent = localStorage.getItem('selectedPort') || 'æœªè®¾ç½®';
    document.getElementById('cpuThreshold').textContent = localStorage.getItem('cpuThreshold') || 'æœªè®¾ç½®';
    document.getElementById('memThreshold').textContent = localStorage.getItem('memThreshold') || 'æœªè®¾ç½®';
    document.getElementById('diskThreshold').textContent = localStorage.getItem('diskThreshold') || 'æœªè®¾ç½®';
    document.getElementById('netThreshold').textContent = localStorage.getItem('netThreshold') || 'æœªè®¾ç½®';
    
    // æ›´æ–°ç›‘æ§çƒçŠ¶æ€
    if (window.monitorManager) {
        document.getElementById('ballStatus').textContent = 
            window.monitorManager.alerts.length > 0 ? 'å‘Šè­¦' : 'æ­£å¸¸';
        document.getElementById('alertCount').textContent = 
            window.monitorManager.alerts.length;
    }
}

function testMonitor() {
    // æ¨¡æ‹Ÿä¸€äº›æµ‹è¯•æ•°æ®
    if (window.monitorManager) {
        window.monitorManager.addAlert(
            'æµ‹è¯•å‘Šè­¦',
            'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‘Šè­¦',
            '85%',
            'é˜ˆå€¼: 80%'
        );
        updateStatus();
    }
}

function clearAlerts() {
    if (window.monitorManager) {
        window.monitorManager.clearAlerts();
        updateStatus();
        alert('å‘Šè­¦å·²æ¸…é™¤');
    }
}

function simulateData() {
    // æ¨¡æ‹Ÿä¸€äº›æµ‹è¯•æ•°æ®æ¥è§¦å‘å‘Šè­¦
    const cpuThreshold = parseFloat(localStorage.getItem('cpuThreshold')) || 80;
    const memThreshold = parseFloat(localStorage.getItem('memThreshold')) || 85;
    const diskThreshold = parseFloat(localStorage.getItem('diskThreshold')) || 90;
    const netThreshold = parseFloat(localStorage.getItem('netThreshold')) || 100;
    
    // æ¨¡æ‹Ÿè¶…è¿‡é˜ˆå€¼çš„æ•°æ®
    const mockData = {
        cpu: { cpu_percent: cpuThreshold + 10 },
        memory: { mem_percent: memThreshold + 5 },
        disk: { disk_percent: diskThreshold + 3 },
        network: { net_speed: netThreshold + 20 }
    };
    
    const thresholds = {
        cpu: cpuThreshold,
        memory: memThreshold,
        disk: diskThreshold,
        network: netThreshold
    };
    
    if (window.monitorManager) {
        window.monitorManager.checkThresholds(mockData, thresholds);
        updateStatus();
        alert('å·²æ¨¡æ‹Ÿæ•°æ®å¹¶æ£€æŸ¥å‘Šè­¦');
    }
}

function clearStorage() {
    // æ¸…é™¤localStorageä¸­çš„è®¾ç½®
    localStorage.removeItem('selectedIp');
    localStorage.removeItem('selectedPort');
    localStorage.removeItem('cpuThreshold');
    localStorage.removeItem('memThreshold');
    localStorage.removeItem('diskThreshold');
    localStorage.removeItem('netThreshold');
    localStorage.removeItem('monitorAlerts');
    
    // æ¸…é™¤å‘Šè­¦
    if (window.monitorManager) {
        window.monitorManager.clearAlerts();
    }
    
    updateStatus();
    alert('è®¾ç½®å·²æ¸…é™¤');
}

function goToDataCollection() {
    window.location.href = '/index/yijiancaiji';
}

// é¡µé¢åŠ è½½æ—¶æ›´æ–°çŠ¶æ€
document.addEventListener('DOMContentLoaded', function() {
    updateStatus();
    
    // å®šæœŸæ›´æ–°çŠ¶æ€
    setInterval(updateStatus, 2000);
});
</script>
{% endblock %} 